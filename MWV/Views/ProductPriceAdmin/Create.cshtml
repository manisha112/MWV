@model MWV.Models.Product_prices
@{
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

<style>
    table, td, th {
        border: 1px solid;
    }

    td {
        padding: 15px;
    }
</style>
<h2 style="margin-top:80px"><b> Create New ProductPrice -> @Html.ActionLink("Goto Home", "Index")</b></h2><br />
 &nbsp;<span id="ErrorMsgs"></span><br />

@Html.AntiForgeryToken()
@Html.ValidationSummary("", new { @class = "text-error" })

<p class="form-label">&nbsp;Customer Name</p>
@Html.DropDownList("Customer", (SelectList)ViewBag.CustList, "Select Customer", new { @class = "select-input" })

<p class="form-label">&nbsp;Product Code</p>
@Html.DropDownList("ProductCode", (SelectList)ViewBag.PrductCode, "Select Product", new { @class = "select-input" })

<p class="form-label">&nbsp;Shade Code</p>
@Html.DropDownList("ShadeCode", (SelectList)ViewBag.ShadeCode, "Select Shade", new { @class = "select-input" })

<div class="form-group">
    <p class="form-label">&nbsp; Unit Price</p>
    <div class="col-md-10">
        @Html.TextBoxFor(m => m.unit_price, new { @class = "text-input", id = "UnitPrice", @placeholder = "Enter UnitPrice(upto 4 decimal digit)", @maxlength = "7", @onfocus = "this.placeholder = ''", @onblur = "this.placeholder = 'Enter UnitPrice(upto 4 decimal digit)'", @type = "number", @step = "any" })
    </div>
</div>

<div class="form-group">
    <p class="form-label">&nbsp;Start Date</p>
    <div id="divStartDate" class="order_by_date_range">

        <select class="date-select-input" id="StartDate">
            <option>DD</option>
            <option value="01">01</option>
            <option value="02">02</option>
            <option value="03">03</option>
            <option value="04">04</option>
            <option value="05">05</option>
            <option value="06">06</option>
            <option value="07">07</option>
            <option value="08">08</option>
            <option value="09">09</option>
            <option value="10">10</option>
            <option value="11">11</option>
            <option value="12">12</option>
            <option value="13">13</option>
            <option value="14">14</option>
            <option value="15">15</option>
            <option value="16">16</option>
            <option value="17">17</option>
            <option value="18">18</option>
            <option value="19">19</option>
            <option value="20">20</option>
            <option value="21">21</option>
            <option value="22">22</option>
            <option value="23">23</option>
            <option value="24">24</option>
            <option value="25">25</option>
            <option value="26">26</option>
            <option value="27">27</option>
            <option value="28">28</option>
            <option value="29">29</option>
            <option value="30">30</option>
            <option value="31">31</option>
        </select>

        <select class="date-select-input" id="StartMonth">
            <option>MM</option>
            <option value="01">01</option>
            <option value="02">02</option>
            <option value="03">03</option>
            <option value="04">04</option>
            <option value="05">05</option>
            <option value="06">06</option>
            <option value="07">07</option>
            <option value="08">08</option>
            <option value="09">09</option>
            <option value="10">10</option>
            <option value="11">11</option>
            <option value="12">12</option>
        </select>

        <select class="date-select-input year" id="StartYear">
            <option>YYYY</option>
            <option value="2015">2015</option>
            <option value="2016">2016</option>
            <option value="2017">2017</option>
            <option value="2018">2018</option>
            <option value="2019">2019</option>
            <option value="2020">2020</option>
        </select>
    </div>
</div>
<br /><br /> <br />

<div class="form-group">
    <div id="divEndDate" class="col-md-10">
        <p class="form-label">&nbsp;End Date</p>
        <select class="date-select-input" id="EndDate">
            <option>DD</option>
            <option value="01">01</option>
            <option value="02">02</option>
            <option value="03">03</option>
            <option value="04">04</option>
            <option value="05">05</option>
            <option value="06">06</option>
            <option value="07">07</option>
            <option value="08">08</option>
            <option value="09">09</option>
            <option value="10">10</option>
            <option value="11">11</option>
            <option value="12">12</option>
            <option value="13">13</option>
            <option value="14">14</option>
            <option value="15">15</option>
            <option value="16">16</option>
            <option value="17">17</option>
            <option value="18">18</option>
            <option value="19">19</option>
            <option value="20">20</option>
            <option value="21">21</option>
            <option value="22">22</option>
            <option value="23">23</option>
            <option value="24">24</option>
            <option value="25">25</option>
            <option value="26">26</option>
            <option value="27">27</option>
            <option value="28">28</option>
            <option value="29">29</option>
            <option value="30">30</option>
            <option value="31">31</option>
        </select>

        <select class="date-select-input" id="EndMonth">
            <option>MM</option>
            <option value="01">01</option>
            <option value="02">02</option>
            <option value="03">03</option>
            <option value="04">04</option>
            <option value="05">05</option>
            <option value="06">06</option>
            <option value="07">07</option>
            <option value="08">08</option>
            <option value="09">09</option>
            <option value="10">10</option>
            <option value="11">11</option>
            <option value="12">12</option>
        </select>

        <select class="date-select-input year" id="EndYear">
            <option>YYYY</option>
            <option value="2015">2015</option>
            <option value="2016">2016</option>
            <option value="2017">2017</option>
            <option value="2018">2018</option>
            <option value="2019">2019</option>
            <option value="2020">2020</option>
        </select>
    </div>
</div>
<br /><br /> <br /><br />

<div class="form-group">
    <div class="col-md-offset-2 col-md-10">
        <input type="submit" class="btn btn-default" id="btnAddProductPrice" value="Create" />
    </div>
</div>
<br />
<div class="form-group">
    <div class="col-md-offset-2 col-md-10">
        <input type="button" class="btn btn-default" title="Cancel" value="Cancel" id="btnCancel" onclick="location.href='@Url.Action("Index", "ProductPriceAdmin")'" />
    </div>
</div><br /><br />
<br /><br />

@*@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}*@
<script type="text/javascript">

    function CheckProductPriceValidation() {

        // var UnitPriceChk = CheckUnitPrice($('#UnitPrice').val());
        var fromdt1 = $('#StartMonth').val() + "/" + $('#StartDate').val() + "/" + $('#StartYear').val();
        var todt1 = $('#EndMonth').val() + "/" + $('#EndDate').val() + "/" + $('#EndYear').val();

        // var dateCompare = CompareDate(fromdt1, todt1);

        if ($('#Customer').val() == "Select Customer" || $('#Customer').val().trim() == "" || $('#Customer').val() == "") {
            $('#ErrorMsgs').html("<p class='error-msg'>Please Select Customer!</p>");
            return false;
        }
        if ($('#ProductCode').val() == "Select Product" || $('#ProductCode').val().trim() == "" || $('#ProductCode').val() == "") {
            $('#ErrorMsgs').html("<p class='error-msg'>Please select product code!</p>");
            return false;
        }
        else if ($('#ShadeCode').val() == "Select Shade" || $('#ShadeCode').val().trim() == "" || $('#ShadeCode').val() == "") {
            $('#ErrorMsgs').html("<p class='error-msg'>Please Select Shade!</p>");
            return false;
        }
        else if (CheckUnitPrice($('#UnitPrice').val()) == false) {
            return false;
        }
        else if ($('#StartDate').val() == "DD" || $('#StartMonth').val() == "MM" || $('#StartYear').val() == "YYYY") {
            $('#ErrorMsgs').html("<p class='error-msg'>Please select valid start Date!</p>");
            return false;
        }
        else if ($('#EndDate').val() == "DD" || $('#EndMonth').val() == "MM" || $('#EndYear').val() == "YYYY") {
            $('#ErrorMsgs').html("<p class='error-msg'>Please select valid End Date!!</p>");
            return false;
        }
        else if (CompareDate(fromdt1, todt1) == false) {
            $('#ErrorMsgs').html("<p class='error-msg'>End Date should be greater than Start Date !");
            return false;
        }

        else {
            return true;
        }
    }

    function CheckUnitPrice(UnitPrice) {
        // 
        var len = UnitPrice.length;
        // var getWid = parseFloat(UnitPrice);
        if (UnitPrice == "Enter UnitPrice(upto 4 decimal digit)" || UnitPrice == "" || UnitPrice.trim() == "") {
            $('#ErrorMsgs').html("<p class='error-msg'>Please enter UnitPrice!</p>");
            return false;
        }
        else if (UnitPrice.charAt(0) == '.') {
            $('#ErrorMsgs').html("<p class='error-msg'>UnitPrice should be numeric.!</p>");
            return false;
        }
        else if (!/^(?=.)(?:\d+,)*\d*(?:\.\d+)?$/.test(UnitPrice)) {
            $('#ErrorMsgs').html("<p class='error-msg'>UnitPrice should be numeric.!</p>");
            return false;
        }
            // else if (!/^(\d+)?(?:\.\d{1,4})?$/.test(UnitPrice)) {
        else if (!/^(\d+)?(?:\.\d{1,4})?$/.test(UnitPrice)) {
            $('#ErrorMsgs').html("<p class='error-msg'>Only 4 decimal places are allowed in UnitPrice!</p>");
            return false;
        }

        return true;

    }

    function CompareDate(fromdtChk, todtChk) {
        if (Date.parse(fromdtChk) > Date.parse(todtChk)) {
            return false;
        }
        else {
            return true;
        }
    }

    $('#btnAddProductPrice').click(function () {
        //

        var CustomerID = $('#Customer').val();
        var ProductCode = $('#ProductCode').val();
        var ShadeCode = $('#ShadeCode').val();
        var UnitPrice = $('#UnitPrice').val();
        var StartDate = $('#StartDate').val() + "/" + $('#StartMonth').val() + "/" + $('#StartYear').val();
        var EndDate = $('#EndDate').val() + "/" + $('#EndMonth').val() + "/" + $('#EndYear').val();
        var msg = "";

        if (CheckProductPriceValidation() == true) {
            // 
            var datatosend = {
                CustomerID: CustomerID,
                ProductCode: ProductCode,
                ShadeCode: ShadeCode,
                UnitPrice: UnitPrice,
                StartDate: StartDate,
                EndDate: EndDate
            }
            $.ajax({
                url: "/ProductPriceAdmin/AddProductPrice/",
                data: datatosend,
                contentType: "application/html; charset=utf-8",
                type: "GET",
                dataType: 'html'
            })
                      .success(function (result) {
                          // alert(result);
                          // 
                          var arrMsgCode = result.split('-');
                          var msgNo, OverlappingStartDt, OverlappingEndDt;
                          msgNo = arrMsgCode[0];//get code here

                          if (msgNo == "1") {
                              $("#ErrorMsgs").html('');
                              $("#ErrorMsgs").html("<p class='error-msg'>" + 'Price already defined for these dates !' + "</p>");
                              return false;
                          }
                          else if (msgNo == "2") {
                              $("#ErrorMsgs").html('');
                              OverlappingStartDt = arrMsgCode[1];
                              OverlappingEndDt = arrMsgCode[2];
                              $("#ErrorMsgs").html("<p class='error-msg'>" + 'Dates are overlapping!.Start Date is falling between previously defined duration ' + OverlappingStartDt + ' and ' + OverlappingEndDt + ' ' + "</p>");
                              return false;
                          }
                          else if (msgNo == "3") {
                              msg = 'ProductPrice added successfully!';
                              window.location.href = "/ProductPriceAdmin/Index?msg=" + msg;
                          }
                          else {
                              $("#ErrorMsgs").html("<p class='error-msg'>" + 'Error while adding ProductPrice.!' + "</p>");
                              return false;
                          }

                      })
                     .error(function (xhr, ajaxOptions, thrownError) {
                     })
        }

    });
</script>